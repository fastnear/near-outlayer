# OffchainVM Worker Configuration
# Copy this file to .env and fill in your values

# ============================================================================
# REQUIRED CONFIGURATION
# ============================================================================

# Coordinator API Configuration
# URL of the coordinator API service
API_BASE_URL=http://localhost:8080

# Bearer token for authenticating with coordinator API
# Must match the token configured in coordinator
API_AUTH_TOKEN=your_secret_token_here

# NEAR Network Configuration
# RPC endpoint for NEAR blockchain
# Testnet: https://rpc.testnet.near.org
# Mainnet: https://rpc.mainnet.near.org
# For RPC providers with API keys, include the key in the URL:
#   Example (Pagoda): https://near-testnet.api.pagoda.co/rpc/v1/YOUR_API_KEY
#   Example (Infura): https://near-testnet.infura.io/v3/YOUR_API_KEY
NEAR_RPC_URL=https://rpc.testnet.near.org

# Neardata API URL for event monitoring
# Testnet: https://testnet.neardata.xyz/v0/block
# Mainnet: https://mainnet.neardata.xyz/v0/block
# For Neardata with API keys, include the key in the URL as query parameter:
#   Example: https://testnet.neardata.xyz/v0/block?api_key=YOUR_API_KEY
# Default: https://testnet.neardata.xyz/v0/block
# NEARDATA_API_URL=https://testnet.neardata.xyz/v0/block/{block_id}?apiKey=key

# Starting block height for event monitoring
# Use 0 to auto-detect latest block (fetches from FastNEAR API)
# Or specify a block number to start from specific height
# Default: 0 (auto-detect)
# START_BLOCK_HEIGHT=0

# FastNEAR API URL for fetching latest block height
# Auto-detected based on NEARDATA_API_URL (testnet/mainnet)
# Testnet: https://test.api.fastnear.com/status
# Mainnet: https://api.fastnear.com/status
# FASTNEAR_API_URL=https://test.api.fastnear.com/status

# OffchainVM contract account ID on NEAR
# This is the contract that emits execution_requested events
OFFCHAINVM_CONTRACT_ID=offchainvm.testnet

# Worker operator account ID
# This account must have operator role on the OffchainVM contract
# and sufficient NEAR balance for gas fees
OPERATOR_ACCOUNT_ID=worker1.testnet

# Operator account private key (ed25519 format)
# Generate with: near-cli keys <account_id>
# Format: ed25519:base58_encoded_private_key
OPERATOR_PRIVATE_KEY=ed25519:YOUR_PRIVATE_KEY_HERE

# ============================================================================
# OPTIONAL CONFIGURATION (with defaults)
# ============================================================================

# Worker Settings
# Unique identifier for this worker instance
# Default: random UUID
# WORKER_ID=worker-1

# Enable NEAR blockchain event monitoring
# If true, worker monitors blockchain for execution_requested events
# If false, worker only polls coordinator API for tasks
# Default: false
# ENABLE_EVENT_MONITOR=false

# Long-poll timeout in seconds (1-300)
# How long to wait for new tasks before timing out
# Default: 60
# POLL_TIMEOUT_SECONDS=60

# Scan interval in seconds between block checks
# How long to wait between checking for new blocks
# Default: 1
# SCAN_INTERVAL_SECONDS=1

# Docker Compilation Settings
# Docker image to use for compiling GitHub repositories
# Supports wasm32-wasi, wasm32-wasip1, wasm32-wasip2 targets
# Recommended: zavodil/wasmedge-compiler:latest (includes Rust 1.85 + WASI SDK 25 + wasm32-wasip2)
# Default: rust:1.75 (basic Rust with wasm32-wasi support only)
# DOCKER_IMAGE=zavodil/wasmedge-compiler:latest

# Maximum time allowed for compilation in seconds (1-3600)
# Default: 300 (5 minutes)
# COMPILE_TIMEOUT_SECONDS=300

# Maximum memory for compilation in MB (minimum 512)
# Default: 2048 (2 GB)
# COMPILE_MEMORY_LIMIT_MB=2048

# Maximum CPU cores for compilation
# Default: 2.0
# COMPILE_CPU_LIMIT=2.0

# WASM Execution Default Limits
# These are used when the contract doesn't specify limits

# Maximum number of WASM instructions
# Default: 10000000000 (10 billion)
# DEFAULT_MAX_INSTRUCTIONS=10000000000

# Maximum memory usage in MB
# Default: 128
# DEFAULT_MAX_MEMORY_MB=128

# Maximum execution time in seconds
# Default: 60
# DEFAULT_MAX_EXECUTION_SECONDS=60

# ============================================================================
# KEYSTORE WORKER CONFIGURATION (Optional - for secret decryption)
# ============================================================================

# Keystore worker URL
# If set, worker will request secret decryption from keystore
# If not set, encrypted secrets will be ignored
# Example: http://localhost:8081
# KEYSTORE_BASE_URL=http://localhost:8081

# Keystore authentication token
# Must match a token configured in keystore worker
# Only required if KEYSTORE_BASE_URL is set
# KEYSTORE_AUTH_TOKEN=your_keystore_token_here

# TEE mode for attestation generation
# Options: sgx, sev, simulated, none
# - sgx: Intel SGX attestation (production)
# - sev: AMD SEV-SNP attestation (production)
# - simulated: Simulated TEE for testing
# - none: No TEE, no attestation (dev mode)
# Default: none
# TEE_MODE=none

# ============================================================================
# LOGGING CONFIGURATION
# ============================================================================

# Logging level (set via RUST_LOG environment variable)
# Examples:
#   info  - Standard logging (recommended for production)
#   debug - Detailed logging (recommended for development)
#   trace - Very verbose logging (for debugging issues)
#
# Usage:
#   RUST_LOG=offchainvm_worker=info cargo run
#   RUST_LOG=offchainvm_worker=debug cargo run

# ============================================================================
# DEBUG CONFIGURATION (Admin Only)
# ============================================================================

# Save raw compilation/execution logs to system_hidden_logs table
# ⚠️ SECURITY WARNING: These logs may contain system file contents from malicious code
# ⚠️ The system_hidden_logs table should NEVER be exposed via public API
# ⚠️ Access ONLY via /admin/* endpoints on localhost/SSH
#
# When enabled, stores raw stderr/stdout for admin debugging
# When disabled, only safe user-facing error descriptions are stored
#
# Options: true, false
# Default: true (enabled for debugging)
# Production recommendation: false
#
# SAVE_SYSTEM_HIDDEN_LOGS_TO_DEBUG=true

# ============================================================================
# EXAMPLE CONFIGURATIONS
# ============================================================================

# --- Local Development Example ---
# API_BASE_URL=http://localhost:8080
# API_AUTH_TOKEN=dev-token-123
# NEAR_RPC_URL=https://rpc.testnet.near.org
# OFFCHAINVM_CONTRACT_ID=dev-offchainvm.testnet
# OPERATOR_ACCOUNT_ID=dev-worker.testnet
# OPERATOR_PRIVATE_KEY=ed25519:...
# WORKER_ID=dev-worker-1
# ENABLE_EVENT_MONITOR=false

# --- Production Example (Testnet) ---
# API_BASE_URL=https://coordinator.example.com
# API_AUTH_TOKEN=prod_token_random_secure_string
# NEAR_RPC_URL=https://rpc.testnet.near.org
# OFFCHAINVM_CONTRACT_ID=offchainvm.testnet
# OPERATOR_ACCOUNT_ID=worker1.example.near
# OPERATOR_PRIVATE_KEY=ed25519:...
# WORKER_ID=prod-worker-1
# ENABLE_EVENT_MONITOR=true
# COMPILE_TIMEOUT_SECONDS=600
# COMPILE_MEMORY_LIMIT_MB=4096

# --- Production Example (Mainnet) ---
# API_BASE_URL=https://coordinator.example.com
# API_AUTH_TOKEN=prod_token_random_secure_string
# NEAR_RPC_URL=https://rpc.mainnet.near.org
# OFFCHAINVM_CONTRACT_ID=offchainvm.near
# OPERATOR_ACCOUNT_ID=worker1.example.near
# OPERATOR_PRIVATE_KEY=ed25519:...
# WORKER_ID=prod-worker-mainnet-1
# ENABLE_EVENT_MONITOR=true
