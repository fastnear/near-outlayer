# =============================================================================
# NEAR OutLayer Keystore - Phala Cloud Configuration
# =============================================================================
#
# This file contains configuration for deploying the keystore worker to Phala Cloud.
# The keystore runs in Intel TDX TEE and provides secure secret decryption.
#
# SECURITY:
# - This file should NEVER be committed to git
# - Copy it to .env.keystore-phala and fill in your values
# - Use strong random tokens (32+ bytes)
# - Keystore must be isolated - only coordinator and workers can access it
#
# =============================================================================

# -----------------------------------------------------------------------------
# Server Configuration
# -----------------------------------------------------------------------------

# Bind address (0.0.0.0 to accept connections from any interface)
SERVER_HOST=0.0.0.0

# Port (8081 is default, Phala Cloud will expose it with unique domain)
SERVER_PORT=8081

# -----------------------------------------------------------------------------
# NEAR Blockchain Configuration
# -----------------------------------------------------------------------------

# NEAR network: "testnet" or "mainnet"
NEAR_NETWORK=testnet

# NEAR RPC URL (for reading secrets from contract)
# Examples:
#   - Public testnet: https://rpc.testnet.near.org
#   - Pagoda RPC (with API key): https://near-testnet.api.pagoda.co/rpc/v1/YOUR_API_KEY
#   - Custom RPC: https://your-rpc.example.com
NEAR_RPC_URL=https://rpc.testnet.near.org

# OffchainVM contract account ID (where secrets are stored)
OFFCHAINVM_CONTRACT_ID=outlayer.testnet

# -----------------------------------------------------------------------------
# Authentication (CRITICAL SECURITY)
# -----------------------------------------------------------------------------

# Allowed worker token hashes (SHA256) - comma-separated list
#
# How to generate:
# 1. Create a strong random token:
#    TOKEN=$(openssl rand -hex 32)
#    echo "Token: $TOKEN"
#
# 2. Hash it with SHA256:
#    HASH=$(echo -n "$TOKEN" | sha256sum | cut -d' ' -f1)
#    echo "Hash: $HASH"
#
# 3. Add hash to this config (multiple tokens separated by comma):
#    ALLOWED_WORKER_TOKEN_HASHES=hash1,hash2,hash3
#
# 4. Give the original token to workers (not the hash!)
#    Workers set: KEYSTORE_AUTH_TOKEN=$TOKEN
#
# Example token: fasnter-outlayer-987
# SHA256 hash: 8c5e8a9d7b3e4f2c1a6d5e7f8b9c0a1d2e3f4a5b6c7d8e9f0a1b2c3d4e5f6a7b
ALLOWED_WORKER_TOKEN_HASHES=8c5e8a9d7b3e4f2c1a6d5e7f8b9c0a1d2e3f4a5b6c7d8e9f0a1b2c3d4e5f6a7b

# -----------------------------------------------------------------------------
# TEE Configuration
# -----------------------------------------------------------------------------

# TEE mode: "tdx" (Intel TDX on Phala Cloud), "simulated" (testing), "none" (dev)
TEE_MODE=tdx

# -----------------------------------------------------------------------------
# Master Secret (CRITICAL - NEVER SHARE)
# -----------------------------------------------------------------------------

# Master secret for deriving per-repo keypairs (32 bytes hex)
#
# IMPORTANT:
# - If not set, keystore will generate a new random secret on startup
# - All encrypted secrets will become invalid if this changes
# - Save this value and keep it secret!
#
# How to generate:
#   openssl rand -hex 32
#
# In production TEE:
# - This could be sealed to TEE storage
# - Or derived from TEE attestation
# - For MVP, use environment variable
#
# Example (DO NOT USE THIS VALUE):
# KEYSTORE_MASTER_SECRET=a1b2c3d4e5f6a7b8c9d0e1f2a3b4c5d6e7f8a9b0c1d2e3f4a5b6c7d8e9f0a1b2
KEYSTORE_MASTER_SECRET=

# =============================================================================
# Phala Cloud Deployment Notes
# =============================================================================
#
# 1. Keystore will get a unique URL like: https://keystore-abc123.phala.cloud
# 2. This URL should be used by workers: KEYSTORE_BASE_URL=https://keystore-abc123.phala.cloud
# 3. Workers must have the same KEYSTORE_AUTH_TOKEN (not the hash!)
# 4. Coordinator can proxy requests to keystore for dashboard access
# 5. Never expose keystore URL publicly - only for internal worker <-> keystore communication
#
# Architecture:
#
#   ┌──────────────────────────────────┐
#   │  Worker TEE                       │
#   │  KEYSTORE_BASE_URL=https://...   │
#   │  KEYSTORE_AUTH_TOKEN=secret123   │
#   └────────────┬─────────────────────┘
#                │
#                │ HTTPS + Bearer Token
#                │
#   ┌────────────▼─────────────────────┐
#   │  Keystore TEE                     │
#   │  https://keystore-abc.phala.cloud│
#   │  Validates token hash             │
#   │  Decrypts secrets                 │
#   └──────────────────────────────────┘
#
# =============================================================================
