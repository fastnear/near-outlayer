# ============================================================================
# NEAR OUTLAYER - PHALA CLOUD DEPLOYMENT CONFIGURATION
# ============================================================================
#
# Copy this file to .env.phala and fill in your values:
#   cp .env.phala.example .env.phala
#
# IMPORTANT: Keep this file SECRET! It contains private keys and tokens.
#
# These environment variables will be encrypted by Phala Cloud before
# deployment to the TDX TEE environment.
#
# ============================================================================

# ============================================================================
# DOCKER IMAGES
# ============================================================================

# Worker Docker image (push to Docker Hub first)
# Example: yourusername/near-offshore-worker:v1.0.0
DOCKER_IMAGE_WORKER=your-dockerhub-username/near-offshore-worker:latest

# Keystore Docker image (optional - only if using encrypted secrets)
# Example: yourusername/near-offshore-keystore:v1.0.0
# DOCKER_IMAGE_KEYSTORE=your-dockerhub-username/near-offshore-keystore:latest

# ============================================================================
# COORDINATOR API (REQUIRED)
# ============================================================================

# Coordinator API endpoint - MUST be publicly accessible
# Example: https://api.your-domain.com
#
# IMPORTANT:
# - Must use HTTPS (not http://)
# - Cannot use localhost or 127.0.0.1
# - Must be reachable from Phala Cloud network
#
API_BASE_URL=https://your-coordinator-domain.com

# Worker authentication token
# Generate with: openssl rand -hex 32
# This must match the token_hash in coordinator database:
#   echo -n "your-token-here" | sha256sum
API_AUTH_TOKEN=your-secure-token-here

# ============================================================================
# NEAR BLOCKCHAIN CONFIGURATION (REQUIRED)
# ============================================================================

# NEAR RPC endpoint
# Options:
#   Testnet: https://rpc.testnet.near.org
#   Mainnet: https://rpc.mainnet.near.org
#   Pagoda (with API key): https://near-testnet.api.pagoda.co/rpc/v1/YOUR_API_KEY
#   Infura: https://near-testnet.infura.io/v3/YOUR_API_KEY
NEAR_RPC_URL=https://rpc.testnet.near.org

# OffchainVM contract account ID
# Example: outlayer.testnet
OFFCHAINVM_CONTRACT_ID=outlayer.testnet

# Worker operator account (has access keys for calling resolve_execution)
# This account submits execution results back to the contract
OPERATOR_ACCOUNT_ID=worker.outlayer.testnet

# Operator account private key (ed25519 format)
# Example: ed25519:2xKj9F8...full_key_here
#
# CRITICAL: Keep this secret! Anyone with this key can submit results
# as your worker and potentially steal funds from failed executions.
OPERATOR_PRIVATE_KEY=ed25519:YOUR_PRIVATE_KEY_HERE

# ============================================================================
# WORKER REGISTRATION (OPTIONAL - for TEE key attestation)
# ============================================================================

# Register contract account ID (optional)
# If set, worker will register its public key with TDX attestation on startup
# Leave empty to disable worker registration
#
# Example: register.outlayer.testnet
# REGISTER_CONTRACT_ID=register.outlayer.testnet

# Intel collateral JSON for TDX quote verification (optional)
# Only needed if register contract doesn't have cached collateral
# Fetch with: ./scripts/fetch_intel_collateral.sh
#
# Format: Single-line JSON (escape quotes if needed)
# REGISTER_COLLATERAL_JSON='{"tcb_info":"...","qe_identity":"...",...}'

# ============================================================================
# KEYSTORE CONFIGURATION (OPTIONAL - for encrypted secrets)
# ============================================================================

# Keystore service URL
#
# TWO DEPLOYMENT OPTIONS:
#
# Option 1: Separate Phala Cloud deployment (RECOMMENDED for production)
#   - Deploy keystore as separate Phala TDX instance
#   - Get unique URL: https://keystore-abc123.phala.cloud
#   - Workers connect via HTTPS from different TEE
#   - Better isolation and security
#
#   KEYSTORE_BASE_URL=https://keystore-abc123.phala.cloud
#
# Option 2: Same docker-compose (simpler for testing)
#   - Run keystore and worker in same docker-compose
#   - Use service name: http://keystore:8081
#   - Shared network namespace (less isolation)
#
#   KEYSTORE_BASE_URL=http://keystore:8081
#
# For production: Use Option 1 with separate Phala deployment
KEYSTORE_BASE_URL=https://keystore-your-id.phala.cloud

# Keystore authentication token
# Must match token used to generate ALLOWED_WORKER_TOKEN_HASHES in keystore config
# Generate with: openssl rand -hex 32
# KEYSTORE_AUTH_TOKEN=your-keystore-token

# ============================================================================
# LOGGING CONFIGURATION
# ============================================================================

# Rust logging level
# Options: error, warn, info, debug, trace
# Recommended: info for production, debug for development
RUST_LOG=info

# ============================================================================
# EVENT MONITOR (OPTIONAL)
# ============================================================================

# Enable event monitor to poll NEAR blockchain for new execution requests
# Set to "true" to enable, "false" to disable
# When disabled, worker only processes tasks from coordinator queue
ENABLE_EVENT_MONITOR=false

# Neardata API URL (optional - for event monitoring)
# NEARDATA_API_URL=https://mainnet.neardata.xyz/v0/last_block/final

# FastNEAR API URL (optional - for event monitoring)
# FASTNEAR_API_URL=https://api.fastnear.com

# Block height to start monitoring from (0 = latest)
START_BLOCK_HEIGHT=0

# ============================================================================
# DEPLOYMENT CHECKLIST
# ============================================================================
#
# Before deploying to Phala Cloud:
#
# 1. Build and push Docker images:
#    cd /Users/alice/projects/near-offshore
#    docker build -f docker/Dockerfile.worker-phala -t yourusername/near-offshore-worker:latest .
#    docker push yourusername/near-offshore-worker:latest
#
# 2. Update this .env.phala file with your values
#
# 3. Deploy to Phala Cloud:
#    cd docker
#    phala cvms create --name near-offshore-worker \
#      --compose ./docker-compose.phala.yml \
#      --env-file ./.env.phala \
#      --vcpu 2 --memory 4096 --disk-size 60
#
# 4. Monitor deployment:
#    phala cvms status near-offshore-worker
#    phala cvms logs near-offshore-worker
#
# 5. Verify TDX attestation:
#    phala cvms attestation near-offshore-worker
#
# ============================================================================
